<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INNOHEDGE Daily Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1f2937;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-success {
            background: #10b981;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .summary-label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .summary-value {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .summary-change {
            font-size: 14px;
            font-weight: 600;
        }
        
        .summary-totals {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            font-size: 13px;
        }
        
        .summary-totals div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid #e5e7eb;
        }
        
        td {
            padding: 12px;
            font-size: 14px;
            color: #374151;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .btn-delete {
            padding: 6px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .filter-info {
            margin-top: 12px;
            font-size: 14px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä INNOHEDGE Daily Report</h1>
            <p>Îß§ÏùºÏùò ÏÑ±Í≥ºÎ•º Í∏∞Î°ùÌïòÍ≥† Î∂ÑÏÑùÌïòÏÑ∏Ïöî</p>
        </div>

        <!-- Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†• -->
        <div class="card">
            <h2>üìù Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label>ÎÇ†Ïßú</label>
                    <input type="date" id="inputDate">
                </div>
                <div class="input-group">
                    <label>ÏùºÍ∞Ñ ÏàòÏùµ (USD)</label>
                    <input type="number" id="inputRevenue" placeholder="Ïòà: 10000">
                </div>
                <div class="input-group">
                    <label>ÏùºÍ∞Ñ Í±∞ÎûòÎüâ (LOT)</label>
                    <input type="number" id="inputVolume" placeholder="Ïòà: 500">
                </div>
                <div class="input-group">
                    <label>ÌèâÍ∞Ä Í∏àÏï° (USD)</label>
                    <input type="number" id="inputEvaluation" placeholder="Ïòà: 500000">
                </div>
            </div>
            <button class="btn" onclick="addRecord()">üíæ Í∏∞Î°ù Ï†ÄÏû•</button>
        </div>

        <div id="dataSection" style="display: none;">
            <!-- Í∏∞Í∞Ñ ÌïÑÌÑ∞ & ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ -->
            <div class="card">
                <div class="input-grid">
                    <div class="input-group">
                        <label>ÏãúÏûë ÎÇ†Ïßú</label>
                        <input type="date" id="filterStart" onchange="applyFilter()">
                    </div>
                    <div class="input-group">
                        <label>Ï¢ÖÎ£å ÎÇ†Ïßú</label>
                        <input type="date" id="filterEnd" onchange="applyFilter()">
                    </div>
                    <div class="input-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-secondary" onclick="clearFilter()">üîÑ Ï†ÑÏ≤¥ Î≥¥Í∏∞</button>
                    </div>
                    <div class="input-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="exportToExcel()">üì• ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    </div>
                </div>
                <div class="filter-info" id="filterInfo"></div>
            </div>

            <!-- ÏöîÏïΩ Ïπ¥Îìú -->
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-label">üí∞ ÏùºÍ∞Ñ ÏàòÏùµ</div>
                    <div class="summary-value" id="revenueValue">$0.00</div>
                    <div class="summary-change" id="revenueChange"></div>
                    <div class="summary-totals">
                        <div>
                            <span style="color: #6b7280;">Ï£ºÍ∞Ñ Ìï©Í≥Ñ</span>
                            <span id="revenueWeekly" style="font-weight: 600; color: #374151;">$0.00</span>
                        </div>
                        <div>
                            <span style="color: #6b7280;">ÏõîÍ∞Ñ Ìï©Í≥Ñ</span>
                            <span id="revenueMonthly" style="font-weight: 600; color: #374151;">$0.00</span>
                        </div>
                    </div>
                </div>

                <div class="summary-card">
                    <div class="summary-label">üì¶ ÏùºÍ∞Ñ Í±∞ÎûòÎüâ</div>
                    <div class="summary-value" id="volumeValue">0 LOT</div>
                    <div class="summary-change" id="volumeChange"></div>
                    <div class="summary-totals">
                        <div>
                            <span style="color: #6b7280;">Ï£ºÍ∞Ñ Ìï©Í≥Ñ</span>
                            <span id="volumeWeekly" style="font-weight: 600; color: #374151;">0 LOT</span>
                        </div>
                        <div>
                            <span style="color: #6b7280;">ÏõîÍ∞Ñ Ìï©Í≥Ñ</span>
                            <span id="volumeMonthly" style="font-weight: 600; color: #374151;">0 LOT</span>
                        </div>
                    </div>
                </div>

                <div class="summary-card">
                    <div class="summary-label">üìà ÌèâÍ∞Ä Í∏àÏï°</div>
                    <div class="summary-value" id="evaluationValue">$0.00</div>
                    <div class="summary-change" id="evaluationChange"></div>
                </div>
            </div>

            <!-- Í∑∏ÎûòÌîÑ -->
            <div class="card">
                <h2>üìä Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Ï∂îÏù¥</h2>
                <canvas id="mainChart" height="100"></canvas>
            </div>

            <!-- Í∏∞Î°ù ÎÇ¥Ïó≠ -->
            <div class="card">
                <h2>üìã Í∏∞Î°ù ÎÇ¥Ïó≠</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>ÎÇ†Ïßú</th>
                                <th style="text-align: right;">ÏàòÏùµ (USD)</th>
                                <th style="text-align: right;">Í±∞ÎûòÎüâ (LOT)</th>
                                <th style="text-align: right;">ÌèâÍ∞ÄÍ∏àÏï° (USD)</th>
                                <th style="text-align: center;">ÏÇ≠Ï†ú</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let records = JSON.parse(localStorage.getItem('innohedgeReports') || '[]');
        let chart = null;
        let filteredRecords = records;

        // Ï¥àÍ∏∞Ìôî
        document.getElementById('inputDate').value = new Date().toISOString().split('T')[0];
        updateUI();

        function addRecord() {
            const date = document.getElementById('inputDate').value;
            const revenue = parseFloat(document.getElementById('inputRevenue').value) || 0;
            const volume = parseFloat(document.getElementById('inputVolume').value) || 0;
            const evaluation = parseFloat(document.getElementById('inputEvaluation').value) || 0;

            if (!revenue && !volume && !evaluation) {
                alert('ÏµúÏÜå ÌïòÎÇòÏùò Í∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }

            const record = { date, revenue, volume, evaluation };
            const existingIndex = records.findIndex(r => r.date === date);
            
            if (existingIndex >= 0) {
                records[existingIndex] = record;
            } else {
                records.push(record);
            }

            records.sort((a, b) => new Date(b.date) - new Date(a.date));
            localStorage.setItem('innohedgeReports', JSON.stringify(records));

            document.getElementById('inputRevenue').value = '';
            document.getElementById('inputVolume').value = '';
            document.getElementById('inputEvaluation').value = '';
            document.getElementById('inputDate').value = new Date().toISOString().split('T')[0];

            applyFilter();
            updateUI();
        }

        function deleteRecord(date) {
            if (confirm('Ïù¥ Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                records = records.filter(r => r.date !== date);
                localStorage.setItem('innohedgeReports', JSON.stringify(records));
                applyFilter();
                updateUI();
            }
        }

        function applyFilter() {
            const start = document.getElementById('filterStart').value;
            const end = document.getElementById('filterEnd').value;

            if (!start && !end) {
                filteredRecords = records;
            } else {
                filteredRecords = records.filter(r => {
                    const recordDate = new Date(r.date);
                    const startDate = start ? new Date(start) : null;
                    const endDate = end ? new Date(end) : null;

                    if (startDate && endDate) {
                        return recordDate >= startDate && recordDate <= endDate;
                    } else if (startDate) {
                        return recordDate >= startDate;
                    } else if (endDate) {
                        return recordDate <= endDate;
                    }
                    return true;
                });
            }

            const filterInfo = document.getElementById('filterInfo');
            if (start || end) {
                filterInfo.textContent = `üìä ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞: ${filteredRecords.length}Í∞ú Ìï≠Î™©`;
            } else {
                filterInfo.textContent = '';
            }

            updateUI();
        }

        function clearFilter() {
            document.getElementById('filterStart').value = '';
            document.getElementById('filterEnd').value = '';
            applyFilter();
        }

        function updateUI() {
            if (records.length === 0) {
                document.getElementById('dataSection').style.display = 'none';
                return;
            }

            document.getElementById('dataSection').style.display = 'block';

            const latest = records[0] || { revenue: 0, volume: 0, evaluation: 0 };
            const previous = records[1] || { revenue: 0, volume: 0, evaluation: 0 };

            // ÏöîÏïΩ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('revenueValue').textContent = formatCurrency(latest.revenue);
            document.getElementById('volumeValue').textContent = formatNumber(latest.volume) + ' LOT';
            document.getElementById('evaluationValue').textContent = formatCurrency(latest.evaluation);

            updateChange('revenueChange', latest.revenue, previous.revenue, true);
            updateChange('volumeChange', latest.volume, previous.volume, false);
            updateChange('evaluationChange', latest.evaluation, previous.evaluation, true);

            // Ï£ºÍ∞Ñ/ÏõîÍ∞Ñ Ìï©Í≥Ñ
            document.getElementById('revenueWeekly').textContent = formatCurrency(getTotal('revenue', 7));
            document.getElementById('revenueMonthly').textContent = formatCurrency(getTotal('revenue', 30));
            document.getElementById('volumeWeekly').textContent = formatNumber(getTotal('volume', 7)) + ' LOT';
            document.getElementById('volumeMonthly').textContent = formatNumber(getTotal('volume', 30)) + ' LOT';

            // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
            updateTable();

            // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateChart();
        }

        function updateChange(elementId, current, previous, isCurrency) {
            const element = document.getElementById(elementId);
            if (!previous || previous === 0) {
                element.textContent = '';
                return;
            }

            const change = current - previous;
            const percent = (change / previous) * 100;
            const color = percent >= 0 ? '#10b981' : '#ef4444';
            const arrow = percent >= 0 ? '‚ñ≤' : '‚ñº';
            const changeText = isCurrency ? formatCurrency(Math.abs(change)) : formatNumber(Math.abs(change));

            element.style.color = color;
            element.innerHTML = `${arrow} ${Math.abs(percent).toFixed(2)}% <span style="margin-left: 8px; color: #9ca3af;">(${change >= 0 ? '+' : '-'}${changeText})</span>`;
        }

        function getTotal(field, days) {
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - days);
            return records.filter(r => new Date(r.date) >= cutoffDate).reduce((sum, r) => sum + r[field], 0);
        }

        function updateTable() {
            const tbody = document.getElementById('recordsTable');
            tbody.innerHTML = filteredRecords.map(record => `
                <tr>
                    <td>${record.date}</td>
                    <td style="text-align: right;">${formatCurrency(record.revenue)}</td>
                    <td style="text-align: right;">${formatNumber(record.volume)} LOT</td>
                    <td style="text-align: right;">${formatCurrency(record.evaluation)}</td>
                    <td style="text-align: center;">
                        <button class="btn-delete" onclick="deleteRecord('${record.date}')">ÏÇ≠Ï†ú</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const chartData = filteredRecords.slice(0, 30).reverse();

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(r => formatDate(r.date)),
                    datasets: [
                        {
                            label: 'ÏàòÏùµ (USD)',
                            data: chartData.map(r => r.revenue),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Í±∞ÎûòÎüâ (LOT)',
                            data: chartData.map(r => r.volume),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'ÌèâÍ∞ÄÍ∏àÏï° (USD)',
                            data: chartData.map(r => r.evaluation),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'USD'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'LOT'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        function exportToExcel() {
            if (filteredRecords.length === 0) {
                alert('ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                return;
            }

            let csv = '\uFEFFÎÇ†Ïßú,ÏàòÏùµ (USD),Í±∞ÎûòÎüâ (LOT),ÌèâÍ∞ÄÍ∏àÏï° (USD)\n';
            filteredRecords.forEach(record => {
                csv += `${record.date},${record.revenue},${record.volume},${record.evaluation}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `innohedge_report_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function formatCurrency(num) {
            return '$' + new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-US').format(num);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return (date.getMonth() + 1) + '/' + date.getDate();
        }
    </script>
</body>
</html>